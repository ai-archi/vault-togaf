id: detailed-task-template
name: 详细任务模板
description: 详细流程：起草提案 → 审查对齐 → 实现任务 → 测试验证 → 归档更新
category: task
# 步骤定义
steps:
  - id: draft-proposal
    type: DraftProposalStep
    form:
      title: 起草提案
      schema:
        content:
          type: textarea
          title: 提案内容
          description: |
            💡 提示：请关注以下要点：
            1. 需求分析：明确任务目标和业务价值
            2. 技术方案：选择合适的技术栈和架构模式
            3. 实施计划：制定清晰的实施步骤和时间安排
            4. 风险评估：识别潜在风险并制定应对措施
            5. 关联文件：考虑对现有文档和代码的影响
          required: false
    prompt: |
      你是一个专业的系统架构师，需要基于以下信息起草提案：
      
      任务名称：{{ task.name }}
      任务描述：{{ task.description }}
      方案路径：{{ solutionPath }}

      关联文件：
      {% if relatedFiles %}
      {% for file in relatedFiles %}
      - {{ file.name }} ({{ file.type }}): {{ file.path }}
        {% if file.vaultName %}所属 Vault: {{ file.vaultName }}{% endif %}
      {% endfor %}
      {% else %}
      （暂无关联文件）
      {% endif %}

      关联的代码路径：
      {% if relatedCodePaths %}
      {% for codePath in relatedCodePaths %}
      - {{ codePath }}
      {% endfor %}
      {% else %}
      （暂无关联代码路径）
      {% endif %}
      
      当前步骤表单数据：
      {% if formDataItems %}
      {% for item in formDataItems %}
      - {{ item.key }}: {{ item.value }}
      {% endfor %}
      {% else %}
      （暂无表单数据）
      {% endif %}
      
      请基于以上信息，生成一个详细的提案，包括：
      1. 需求分析
      2. 技术方案
      3. 实施计划
      4. 风险评估
    depends_on: []

  - id: review-alignment
    type: ReviewAlignmentStep
    form:
      title: 审查对齐
      schema:
        content:
          type: textarea
          title: 审查反馈
          description: |
            💡 提示：请关注以下要点：
            1. 提案优点：识别提案中的亮点和优势
            2. 存在问题：检查技术方案的可行性和完整性
            3. 改进建议：提供具体的优化方向和修改意见
            4. 风险评估：评估对关联文件和代码路径的影响
            5. 兼容性：确保方案与现有架构和代码兼容
          required: false
    prompt: |
      你是一个专业的系统架构审查专家，需要审查以下提案：
      
      任务名称：{{ task.name }}
      方案路径：{{ solutionPath }}

      关联文件（审查时需要考虑的上下文）：
      {% if relatedFiles %}
      {% for file in relatedFiles %}
      - {{ file.name }} ({{ file.type }}): {{ file.path }}
        {% if file.vaultName %}所属 Vault: {{ file.vaultName }}{% endif %}
      {% endfor %}
      {% else %}
      （暂无关联文件）
      {% endif %}

      关联的代码路径（可能受影响的代码）：
      {% if relatedCodePaths %}
      {% for codePath in relatedCodePaths %}
      - {{ codePath }}
      {% endfor %}
      {% else %}
      （暂无关联代码路径）
      {% endif %}
      
      当前步骤表单数据：
      {% if formDataItems %}
      {% for item in formDataItems %}
      - {{ item.key }}: {{ item.value }}
      {% endfor %}
      {% else %}
      （暂无表单数据）
      {% endif %}
      
      请基于以上信息，对提案进行审查，并提供：
      1. 提案的优点
      2. 存在的问题（考虑对关联文件的影响）
      3. 改进建议
      4. 风险评估（考虑对关联代码路径的影响）
    depends_on:
      - draft-proposal

  - id: implementation
    type: ImplementationStep
    form:
      title: 实现任务
      schema:
        content:
          type: textarea
          title: 实现内容
          description: |
            💡 提示：请关注以下要点：
            1. 技术实现：参考关联代码路径和文档，确保实现方案可行
            2. 代码结构：设计清晰的目录结构和模块划分
            3. 关键实现：重点关注核心功能的代码实现细节
            4. 测试计划：制定完整的测试策略和用例
            5. 代码质量：遵循项目规范和最佳实践
          required: false
    prompt: |
      你是一个专业的软件开发工程师，需要基于以下信息实现任务：
      
      任务名称：{{ task.name }}
      方案路径：{{ solutionPath }}

      关联的代码路径（需要修改或参考的代码文件）：
      {% if relatedCodePaths %}
      {% for codePath in relatedCodePaths %}
      - {{ codePath }}
      {% endfor %}
      {% else %}
      （暂无关联代码路径）
      {% endif %}

      关联的文档（参考文档）：
      {% if relatedDocuments %}
      {% for doc in relatedDocuments %}
      - {{ doc.name }}: {{ doc.path }}
        {% if doc.vaultName %}所属 Vault: {{ doc.vaultName }}{% endif %}
      {% endfor %}
      {% else %}
      （暂无关联文档）
      {% endif %}

      关联的设计（参考设计）：
      {% if relatedDesigns %}
      {% for design in relatedDesigns %}
      - {{ design.name }}: {{ design.path }}
        {% if design.vaultName %}所属 Vault: {{ design.vaultName }}{% endif %}
      {% endfor %}
      {% else %}
      （暂无关联设计）
      {% endif %}
      
      当前步骤表单数据：
      {% if formDataItems %}
      {% for item in formDataItems %}
      - {{ item.key }}: {{ item.value }}
      {% endfor %}
      {% else %}
      （暂无表单数据）
      {% endif %}
      
      请基于以上信息，生成实现方案，包括：
      1. 技术实现方案（参考关联的代码路径和文档）
      2. 代码文件结构
      3. 关键代码实现（基于关联代码路径进行修改）
      4. 测试计划
    depends_on:
      - review-alignment

  - id: test-verification
    type: TestVerificationStep
    form:
      title: 测试验证
      schema:
        content:
          type: textarea
          title: 测试验证内容
          description: |
            💡 提示：请关注以下要点：
            1. 测试用例：设计覆盖功能、边界和异常场景的测试用例
            2. 测试执行：按照测试计划执行测试，记录详细的测试过程
            3. 测试结果：分析测试结果，识别问题和缺陷
            4. 问题跟踪：记录发现的问题，跟踪修复进度
            5. 回归测试：确保新功能不影响现有功能
          required: false
    prompt: |
      你是一个专业的测试工程师，需要基于以下信息进行测试验证：
      
      任务名称：{{ task.name }}
      方案路径：{{ solutionPath }}

      关联的代码路径（需要测试的代码文件）：
      {% if relatedCodePaths %}
      {% for codePath in relatedCodePaths %}
      - {{ codePath }}
      {% endfor %}
      {% else %}
      （暂无关联代码路径）
      {% endif %}

      关联的文档（测试参考文档）：
      {% if relatedDocuments %}
      {% for doc in relatedDocuments %}
      - {{ doc.name }}: {{ doc.path }}
        {% if doc.vaultName %}所属 Vault: {{ doc.vaultName }}{% endif %}
      {% endfor %}
      {% else %}
      （暂无关联文档）
      {% endif %}
      
      当前步骤表单数据：
      {% if formDataItems %}
      {% for item in formDataItems %}
      - {{ item.key }}: {{ item.value }}
      {% endfor %}
      {% else %}
      （暂无表单数据）
      {% endif %}
      
      请基于以上信息，生成测试验证方案，包括：
      1. 测试用例设计（针对关联的代码路径）
      2. 测试执行计划
      3. 测试结果分析
      4. 问题跟踪
    depends_on:
      - implementation

  - id: archive-update
    type: ArchiveUpdateStep
    form:
      title: 归档更新
      schema:
        content:
          type: textarea
          title: 文档更新内容
          description: |
            💡 提示：请关注以下要点：
            1. 文档列表：列出所有需要更新或创建的文档
            2. 更新内容：基于实现后的代码，更新文档的具体内容
            3. 文档结构：确保文档结构清晰、易于理解
            4. 归档建议：提供文档归档的位置和分类建议
            5. 版本管理：考虑文档版本控制和历史记录
          required: false
    prompt: |
      你是一个专业的文档管理专家，需要基于以下信息更新文档：
      
      任务名称：{{ task.name }}
      方案路径：{{ solutionPath }}

      关联的文档（可能需要更新的文档）：
      {% if relatedDocuments %}
      {% for doc in relatedDocuments %}
      - {{ doc.name }}: {{ doc.path }}
        {% if doc.vaultName %}所属 Vault: {{ doc.vaultName }}{% endif %}
      {% endfor %}
      {% else %}
      （暂无关联文档）
      {% endif %}

      关联的代码路径（实现后的代码，用于更新文档）：
      {% if relatedCodePaths %}
      {% for codePath in relatedCodePaths %}
      - {{ codePath }}
      {% endfor %}
      {% else %}
      （暂无关联代码路径）
      {% endif %}
      
      当前步骤表单数据：
      {% if formDataItems %}
      {% for item in formDataItems %}
      - {{ item.key }}: {{ item.value }}
      {% endfor %}
      {% else %}
      （暂无表单数据）
      {% endif %}
      
      请基于以上信息，生成文档更新方案，包括：
      1. 需要更新的文档列表（优先考虑关联的文档）
      2. 每个文档的更新内容（基于关联代码路径的实现情况）
      3. 文档结构建议
      4. 归档建议
    depends_on:
      - test-verification
